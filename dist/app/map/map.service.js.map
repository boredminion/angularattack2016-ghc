{"version":3,"file":"map.service.js","sourceRoot":"","sources":["map.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport {Observable, Observer} from 'rxjs/Rx';\nimport {Subject}    from 'rxjs/Subject';\nimport {ISpaceObject, SpaceObjectService, SpaceObjectType, AIShip, Upgrade, UpgradeType} from '../ship';\nimport {Direction} from './';\nimport {Cell} from '../cell';\nimport {UserService, User, GlobalService, Settings, NotificationsService} from '../shared';\nimport {Angularattack2016GhcAppComponent} from '../';\n\nexport interface IAction {\n\tlabel: string;\n\taction: any;\n\tactive: boolean;\n\ttime: any;\n}\n\nexport class Action implements IAction {\n\tlabel: string;\n\taction: any;\n\tactive: boolean = true;\n\ttime: any;\n\n\tconstructor(label: string, action: any, time: number) {\n\t\tthis.label = label;\n\t\tthis.action = action;\n\t\tthis.time = time;\n\t\tlet interval = setInterval(() => {\n\t\t\tif (this.time > 0) {\n\t\t\t\tthis.time--;\n\t\t\t}\n\t\t\tif (this.active === false) {\n\t\t\t\tclearInterval(interval);\n\t\t\t}\n\t\t\tif (this.time === 0 && this.active === true) {\n\t\t\t\tthis.time = '';\n\t\t\t\tthis.action();\n\t\t\t\tthis.label = '';\n\t\t\t\tthis.active = false;\n\t\t\t\tclearInterval(interval);\n\t\t\t}\n\t\t}, 1000);\n\t}\n}\n\n@Injectable()\nexport class MapService {\n\n\ttradeMission: any;\n\n\tsettings: Settings = new Settings();\n\tship: User;\n\tships: User[] = [];\n\taiShips: AIShip[] = [];\n\tgrid$: Observable<Cell[][]>;\n\tfullGrid: Cell[][] = [];\n\tvisibleGrid: Cell[][] = [];\n\tgridObserver: Observer<Cell[][]>;\n\tspaceObjects: ISpaceObject[] = [];\n\tprivate _nextActionSource = new Subject<Action>();\n\tnextAction$ = this._nextActionSource.asObservable();\n\tcurrentAction: Action;\n\ttransitions$: Observable<string>;\n\ttransitionsObserver: Observer<string>;\n\tupgrades: Upgrade[];\n\n\tconstructor(\n\t\tprivate userService: UserService,\n\t\tprivate spaceObjectService: SpaceObjectService,\n\t\tprivate globalService: GlobalService,\n\t\tprivate notification: NotificationsService) {\n\t\t\t\n\t\tglobalService.upgrades.subscribe(upgrades => this.upgrades = upgrades);\n\n\t\tthis.grid$ = new Observable(observer => this.gridObserver = observer).share() as Observable<Cell[][]>;\n\t\tthis.grid$.subscribe(grid => {\n\t\t\tthis.visibleGrid = grid;\n\t\t});\n\t\tthis.transitions$ = new Observable(observer => this.transitionsObserver = observer).share() as Observable<string>;\n\n\t\tglobalService.globalSettings$.subscribe(function(settings) {\n\t\t\tthis.settings = settings;\n\t\t\tfor (let i = 0; i < this.settings.mapX; i++) {\n\t\t\t\tthis.visibleGrid.push([]);\n\t\t\t}\n\t\t\tfor (let i = 0; i < this.settings.mapExtent; i++) {\n\t\t\t\tthis.fullGrid.push([]);\n\t\t\t\tfor (let j = 0; j < this.settings.mapExtent; j++) {\n\t\t\t\t\tthis.fullGrid[i][j] = new Cell(i, j);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.userService.users$.subscribe(ships => {\n\t\t\t\tthis.ships = ships;\n\t\t\t\tthis.populateGrid();\n\t\t\t});\n\t\t\tthis.userService.currentUser.subscribe(ship => {\n\t\t\t\tif (this.ship && this.ship.health && this.ship.health !== ship.health && this.ship.health > ship.health) {\n\t\t\t\t\tthis.notification.pop('error', 'You were attacked!', 'You just took ' + (this.ship.health - ship.health) + ' points of damage!');\n\t\t\t\t}\n\t\t\t\tthis.ship = ship;\n\t\t\t});\n\t\t\tthis.spaceObjectService.spaceObjects$.subscribe(objects => {\n\t\t\t\tthis.spaceObjects = objects;\n\t\t\t\tthis.fullGrid.forEach(row => row.forEach(cell => cell.planet = undefined));\n\t\t\t\tthis.aiShips = [];\n\t\t\t\tthis.spaceObjects.forEach(spaceObject => {\n\t\t\t\t\tif (spaceObject.type === SpaceObjectType.AIShip) {\n\t\t\t\t\t\tthis.aiShips.push(spaceObject);\n\t\t\t\t\t}\n\t\t\t\t\tif (spaceObject.x) {\n\t\t\t\t\t\tthis.fullGrid[spaceObject.x][spaceObject.y].planet = spaceObject;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tspaceObjectService.spaceObjects$.remove(spaceObject.$key);\n\t\t\t\t\t}\n\t\t\t\t\tif (spaceObject.type === SpaceObjectType.Explosion && spaceObject.time && Date.now() - spaceObject.time > 1000) {\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tspaceObjectService.spaceObjects$.remove(spaceObject.$key);\n\t\t\t\t\t\t}, 1000)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}.bind(this));\n\n\t\tthis.nextAction$.subscribe(action => {\n\t\t\tthis.currentAction = action;\n\t\t});\n\n\t\tsetInterval(() => this.aiAction(), 1000);\n\t}\n\n\taiAction() {\n\t\tlet ship = this.aiShips[Math.floor(Math.random() * this.aiShips.length)];\n\t\tif (ship && !ship.isControlled) {\n\t\t\tthis.spaceObjectService.spaceObjects$.update(ship.$key, { isControlled: true }).then(() => {\n\t\t\t\tlet order = Math.floor(Math.random() * 4);\n\t\t\t\tswitch (order) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\t//move\n\t\t\t\t\t\tthis.moveForward(ship);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\t//port\n\t\t\t\t\t\tthis.rotateLeft(ship);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\t//stb\n\t\t\t\t\t\tthis.rotateRight(ship);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tthis.pewPew(ship);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tsetTimeout(() => this.spaceObjectService.spaceObjects$.update(ship.$key, { isControlled: false }), 2000);\n\t\t\t});\n\n\t\t}\n\t}\n\n\tcreateAIShip() {\n\t\tlet planetX = Math.floor(Math.random() * this.settings.mapExtent);\n\t\tlet planetY = Math.floor(Math.random() * this.settings.mapExtent);\n\t\tif (!this.fullGrid[planetX][planetY].contents) {\n\t\t\tthis.spaceObjectService.createAIShip(planetX, planetY);\n\t\t}\n\t}\n\n\tcreateAsteroid() {\n\t\tlet planetX = Math.floor(Math.random() * this.settings.mapExtent);\n\t\tlet planetY = Math.floor(Math.random() * this.settings.mapExtent);\n\t\tif (!this.fullGrid[planetX][planetY].planet) {\n\t\t\tthis.spaceObjectService.createAsteroid(planetX, planetY);\n\t\t}\n\t}\n\n\tcreatePlanet() {\n\t\tlet planetX = Math.floor(Math.random() * this.settings.mapExtent);\n\t\tlet planetY = Math.floor(Math.random() * this.settings.mapExtent);\n\t\tif (!this.fullGrid[planetX][planetY].planet) {\n\t\t\tthis.spaceObjectService.createPlanet(planetX, planetY, null);\n\t\t}\n\t}\n\n\tdoAnimations(facing) {\n\t\tlet animation;\n\t\tswitch (facing) {\n\t\t\tcase Direction.Coreward:\n\t\t\t\tanimation = 'coreward';\n\t\t\t\tbreak;\n\t\t\tcase Direction.Trailing:\n\t\t\t\tanimation = 'trailing';\n\t\t\t\tbreak;\n\t\t\tcase Direction.Rimward:\n\t\t\t\tanimation = 'rimward';\n\t\t\t\tbreak;\n\t\t\tcase Direction.Spinward:\n\t\t\t\tanimation = 'spinward';\n\t\t\t\tbreak;\n\t\t}\n\t\tthis.transitionsObserver.next(animation);\n\t\tsetTimeout(() => this.transitionsObserver.next(null), 1000);\n\t}\n\n\tpewPew(aiShip) {\n\t\tlet shootingShip = aiShip || this.ship;\n\t\tlet weaponRange: number = this.settings.baseWeaponRange;\n\t\tlet weaponDamage: number = this.settings.baseWeaponDamage;\n\t\tlet shipHealth: number = this.settings.baseShipHealth;\n\t\tif (!aiShip && this.ship.upgrades) {\n\t\t\tlet shipUpgrades = Object.keys(this.ship.upgrades).map(key => {\n\t\t\t\treturn this.ship.upgrades[key];\n\t\t\t});\n\t\t\tshipUpgrades = shipUpgrades.map(key => {\n\t\t\t\treturn this.upgrades.find(upgrade => {\n\t\t\t\t\treturn upgrade.$key === key;\n\t\t\t\t});\n\t\t\t});\n\t\t\tshipUpgrades.forEach(upgrade => {\n\t\t\t\tif (upgrade.type === UpgradeType.Range) {\n\t\t\t\t\tweaponRange += upgrade.value;\n\t\t\t\t}\n\t\t\t\tif (upgrade.type === UpgradeType.Damage) {\n\t\t\t\t\tweaponDamage += upgrade.value;\n\t\t\t\t}\n\t\t\t\tif (upgrade.type === UpgradeType.Armor) {\n\t\t\t\t\tshipHealth += upgrade.value;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tfor (let i = 1; i <= weaponRange; i++) {\n\t\t\tlet x = 0;\n\t\t\tlet y = 0;\n\t\t\tswitch (shootingShip.facing) {\n\t\t\t\tcase 0:\n\t\t\t\t\tx = this.wraparound(shootingShip.x - i, this.settings.mapExtent);\n\t\t\t\t\ty = (shootingShip.y);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tx = (shootingShip.x);\n\t\t\t\t\ty = this.wraparound(shootingShip.y + i, this.settings.mapExtent);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tx = this.wraparound(shootingShip.x + i, this.settings.mapExtent);\n\t\t\t\t\ty = (shootingShip.y);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tx = (shootingShip.x);\n\t\t\t\t\ty = this.wraparound(shootingShip.y - i, this.settings.mapExtent);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlet hit = false;\n\t\t\tthis.ships.forEach(function(ship: User) {\n\t\t\t\tif (ship.x === x && ship.y === y) {\n\t\t\t\t\tship.currentScore = ship.currentScore - weaponDamage > 0 ? ship.currentScore - weaponDamage : 0;\n\t\t\t\t\tship.stolenScore = ship.stolenScore ? ship.stolenScore + weaponDamage : weaponDamage;\n\t\t\t\t\tship.health = ship.health ? ship.health - weaponDamage : shipHealth - weaponDamage;\n\t\t\t\t\tif (!aiShip) {\n\t\t\t\t\t\tthis.ship.criminalScore = ship.health <= 0 && ship.wanted ? this.ship.criminalScore + 1 : this.ship.criminalScore;\n\t\t\t\t\t\tthis.ship.wanted = ship.wanted ? this.ship.wanted : true;\n\t\t\t\t\t\tthis.ship.bounty = ship.wanted ? (this.ship.bounty ? this.ship.bounty : this.settings.bounty) : (this.ship.bounty ? this.ship.bounty : this.settings.bounty) + this.settings.bounty;\n\t\t\t\t\t\tthis.ship.currentScore = ship.health <= 0 && ship.wanted ? this.ship.currentScore + weaponDamage + ship.bounty : this.ship.currentScore + weaponDamage;\n\t\t\t\t\t\tthis.ship.totalScore = ship.health <= 0 && ship.wanted ? this.ship.totalScore + weaponDamage + ship.bounty : this.ship.totalScore + weaponDamage;\n\t\t\t\t\t\tthis.userService.scoreOwnShip(this.ship);\n\t\t\t\t\t\tthis.userService.scoreShip(ship);\n\t\t\t\t\t}\n\t\t\t\t\thit = true;\n\t\t\t\t\tif (!aiShip) {\n\t\t\t\t\t\tthis.notification.pop('success', 'Hit!', 'You hit ' + ship.shipName + ' for ' + weaponDamage + ' points!');\n\t\t\t\t\t}\n\t\t\t\t\tthis.spaceObjectService.createBoom(x, y, true, ship.facing);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t\tif (!hit) {\n\t\t\t\tthis.spaceObjects.forEach(function(object) {\n\t\t\t\t\tif (object.type === SpaceObjectType.AIShip) {\n\t\t\t\t\t\tlet ship = object as AIShip;\n\t\t\t\t\t\tif (ship.x === x && ship.y === y) {\n\t\t\t\t\t\t\tship.health = ship.health ? ship.health - weaponDamage : shipHealth - weaponDamage;\n\t\t\t\t\t\t\tif (!aiShip) {\n\t\t\t\t\t\t\t\tthis.ship.currentScore = this.ship.currentScore + weaponDamage;\n\t\t\t\t\t\t\t\tthis.ship.totalScore = this.ship.totalScore + weaponDamage;\n\t\t\t\t\t\t\t\tthis.userService.scoreOwnShip(this.ship);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.spaceObjectService.damage(ship);\n\t\t\t\t\t\t\thit = true;\n\t\t\t\t\t\t\tif (!aiShip) {\n\t\t\t\t\t\t\t\tthis.notification.pop('success', 'Hit!', 'You hit a drone for ' + weaponDamage + ' points!');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.spaceObjectService.createBoom(x, y, true, ship.facing);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t\tif (!hit) {\n\t\t\t\tthis.spaceObjectService.createBoom(x, y, false, 0);\n\t\t\t}\n\t\t}\n\t}\n\n\tcollisionCheck(x, y) {\n\t\tlet collide = false;\n\t\tthis.ships.forEach(function(ship) {\n\t\t\tif (ship.x === x && ship.y === y && ship.$key !== this.ship.$key) {\n\t\t\t\tcollide = true;\n\t\t\t}\n\t\t}.bind(this));\n\t\tthis.aiShips.forEach(function(ship) {\n\t\t\tif (ship.x === x && ship.y === y && ship.$key !== this.ship.$key) {\n\t\t\t\tcollide = true;\n\t\t\t}\n\t\t}.bind(this));\n\t\treturn collide;\n\t}\n\n\tforwardCell(ship) {\n\t\tswitch (ship.facing) {\n\t\t\tcase 0:\n\t\t\t\treturn [this.wraparound(ship.x - 1, this.settings.mapExtent), (ship.y)];\n\t\t\tcase 1:\n\t\t\t\treturn [(ship.x), this.wraparound(ship.y + 1, this.settings.mapExtent)];\n\t\t\tcase 2:\n\t\t\t\treturn [this.wraparound(ship.x + 1, this.settings.mapExtent), (ship.y)];\n\t\t\tcase 3:\n\t\t\t\treturn [(ship.x), this.wraparound(ship.y - 1, this.settings.mapExtent)];\n\t\t}\n\t}\n\n\tmoveForward(ship) {\n\t\tlet movingShip = ship || this.ship;\n\t\tlet move = this.forwardCell(movingShip);\n\t\tif (this.collisionCheck(move[0], move[1])) {\n\t\t\treturn;\n\t\t}\n\t\tmovingShip.x = move[0];\n\t\tmovingShip.y = move[1];\n\t\tmovingShip.x = this.wraparound(movingShip.x, this.settings.mapExtent);\n\t\tmovingShip.y = this.wraparound(movingShip.y, this.settings.mapExtent);\n\t\tthis.populateGrid();\n\t\tif (!ship) {\n\t\t\tthis.doAnimations(movingShip.facing);\n\t\t}\n\t\tthis.updateShip(movingShip, !!ship);\n\t}\n\n\trotateRight(ship) {\n\t\tlet turningShip = ship || this.ship;\n\t\tlet oldFacing = turningShip.facing;\n\t\tif (turningShip.facing < 3) {\n\t\t\tturningShip.facing++;\n\t\t} else {\n\t\t\tturningShip.facing = 0;\n\t\t}\n\t\tthis.updateShip(turningShip, !!ship);\n\t}\n\n\trotateLeft(ship) {\n\t\tlet turningShip = ship || this.ship;\n\t\tlet oldFacing = turningShip.facing;\n\t\tif (turningShip.facing) {\n\t\t\tturningShip.facing--;\n\t\t} else {\n\t\t\tturningShip.facing = 3;\n\t\t}\n\t\tthis.updateShip(turningShip, !!ship);\n\t}\n\n\tupdateShip(ship, isAi) {\n\t\tif (isAi) {\n\t\t\tthis.spaceObjectService.spaceObjects$.update(ship.$key, {\n\t\t\t\tx: ship.x,\n\t\t\t\ty: ship.y,\n\t\t\t\tfacing: ship.facing\n\t\t\t});\n\t\t} else {\n\t\t\tthis.userService.moveShip(ship);\n\t\t}\n\t}\n\n\tmine() {\n\t\tlet asteroid = this.fullGrid[this.ship.x][this.ship.y].planet;\n\t\tif (asteroid && asteroid.type === SpaceObjectType.Asteroid) {\n\t\t\tasteroid.size--;\n\t\t\tthis.ship.currentScore++;\n\t\t\tthis.ship.totalScore++;\n\t\t\tthis.userService.scoreOwnShip(this.ship);\n\t\t\tif (asteroid.size) {\n\t\t\t\tthis.spaceObjectService.spaceObjects$.update(asteroid.$key, { size: asteroid.size });\n\t\t\t\tthis.notification.pop('success', 'Mining', 'You have mined valuable resources and increased your score.');\n\t\t\t} else {\n\t\t\t\tthis.spaceObjectService.spaceObjects$.remove(asteroid.$key);\n\t\t\t\tthis.notification.pop('success', 'Mining', 'You have mined valuable resources and increased your score. This asteroid is now depleted.');\n\t\t\t}\n\t\t} else {\n\t\t\tthis.notification.pop('error', 'Mining', 'You can only mine asteroids.');\n\t\t}\n\t}\n\n\ttrade() {\n\t\tlet planet = this.fullGrid[this.ship.x][this.ship.y].planet;\n\t\tif (planet) {\n\t\t\tif (this.tradeMission) {\n\t\t\t\tlet x = Math.abs(this.tradeMission.x - this.ship.x);\n\t\t\t\tlet y = Math.abs(this.tradeMission.y - this.ship.y);\n\t\t\t\tif (x > 50) {\n\t\t\t\t\tx = x - 50;\n\t\t\t\t}\n\t\t\t\tif (y > 50) {\n\t\t\t\t\ty = y - 50;\n\t\t\t\t}\n\t\t\t\tlet score = (x + y) / 2;\n\t\t\t\tif (score) {\n\t\t\t\t\tthis.ship.currentScore += score;\n\t\t\t\t\tthis.ship.totalScore += score;\n\t\t\t\t\tthis.userService.scoreOwnShip(this.ship);\n\t\t\t\t\tthis.notification.pop('success', 'Trade', 'You have sold your goods for a profit and earned ' + score + ' points!');\n\t\t\t\t} else {\n\t\t\t\t\tthis.notification.pop('info', 'Trade', 'You decide not to carry any cargo.');\n\t\t\t\t}\n\t\t\t\tthis.tradeMission = undefined;\n\t\t\t} else {\n\t\t\t\tthis.tradeMission = { x: this.ship.x, y: this.ship.y };\n\t\t\t\tthis.notification.pop('success', 'Trade', 'You load your ship with cargo. You will earn more points the farther you take it.');\n\t\t\t}\n\t\t} else {\n\t\t\tthis.notification.pop('error', 'Trade', 'You can only conduct trade missions at planets.');\n\t\t}\n\t}\n\n\tactionMoveForward() {\n\t\tif (this.currentAction && this.currentAction.label !== 'Move Forward') {\n\t\t\tthis.currentAction.active = false;\n\t\t}\n\t\tif (!this.currentAction || (this.currentAction && this.currentAction.label !== 'Move Forward')) {\n\t\t\tthis._nextActionSource.next(new Action('Move Forward', this.moveForward.bind(this), this.settings.actionDelay));\n\t\t}\n\t}\n\n\tactionRotateLeft() {\n\t\tif (this.currentAction && this.currentAction.label !== 'Rotate Left') {\n\t\t\tthis.currentAction.active = false;\n\t\t}\n\t\tif (!this.currentAction || (this.currentAction && this.currentAction.label !== 'Rotate Left')) {\n\t\t\tthis._nextActionSource.next(new Action('Rotate Left', this.rotateLeft.bind(this), this.settings.actionDelay));\n\t\t}\n\t}\n\n\tactionRotateRight() {\n\t\tif (this.currentAction && this.currentAction.label !== 'Rotate Right') {\n\t\t\tthis.currentAction.active = false;\n\t\t}\n\t\tif (!this.currentAction || (this.currentAction && this.currentAction.label !== 'Rotate Right')) {\n\t\t\tthis._nextActionSource.next(new Action('Rotate Right', this.rotateRight.bind(this), this.settings.actionDelay));\n\t\t}\n\t}\n\n\tactionFireWeapon() {\n\t\tif (this.currentAction && this.currentAction.label !== 'Fire') {\n\t\t\tthis.currentAction.active = false;\n\t\t}\n\t\tif (!this.currentAction || (this.currentAction && this.currentAction.label !== 'Fire')) {\n\t\t\tthis._nextActionSource.next(new Action('Fire', this.pewPew.bind(this), this.settings.actionDelay));\n\t\t}\n\t}\n\n\tactionMine() {\n\t\tif (this.currentAction && this.currentAction.label !== 'Mine') {\n\t\t\tthis.currentAction.active = false;\n\t\t}\n\t\tif (!this.currentAction || (this.currentAction && this.currentAction.label !== 'Mine')) {\n\t\t\tthis._nextActionSource.next(new Action('Mine', this.mine.bind(this), this.settings.actionDelay));\n\t\t}\n\t}\n\n\tactionTrade() {\n\t\tif (this.currentAction && this.currentAction.label !== 'Trade') {\n\t\t\tthis.currentAction.active = false;\n\t\t}\n\t\tif (!this.currentAction || (this.currentAction && this.currentAction.label !== 'Trade')) {\n\t\t\tthis._nextActionSource.next(new Action('Trade', this.trade.bind(this), this.settings.actionDelay));\n\t\t}\n\t}\n\n\tkeyAction(event: KeyboardEvent) {\n\t\tif (event.keyCode === 32) {\n\t\t\tthis.actionFireWeapon();\n\t\t}\n\t\tif (event.keyCode === 38 || event.keyCode === 87) {\n\t\t\tthis.actionMoveForward();\n\t\t}\n\t\tif (event.keyCode === 36 || event.keyCode === 81) {\n\t\t\tthis.actionRotateLeft();\n\t\t}\n\t\tif (event.keyCode === 33 || event.keyCode === 69) {\n\t\t\tthis.actionRotateRight();\n\t\t}\n\t}\n\n\tpopulateGrid() {\n\t\tthis.ships.forEach(ship => {\n\t\t\tif (ship.online) {\n\t\t\t\tlet shipKeys = Object.keys(ship);\n\t\t\t\tif (shipKeys.indexOf('x') > -1 && shipKeys.indexOf('y') > -1) {\n\t\t\t\t\tif (this.fullGrid[ship.x][ship.y].contents !== null) {\n\t\t\t\t\t\tlet gridShip: User = this.fullGrid[ship.x][ship.y].contents;\n\n\t\t\t\t\t\tif (gridShip && gridShip.x === ship.x && gridShip.y === ship.y && gridShip.facing === ship.facing && gridShip.$key === ship.$key) {\n\t\t\t\t\t\t\t//don't do anything, ship didn't rotate or move\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (gridShip && gridShip.x === ship.x && gridShip.y === ship.y) {\n\t\t\t\t\t\t\t\t// ship may be rotating\n\t\t\t\t\t\t\t\tthis.fullGrid[ship.x][ship.y].contents = ship;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.fullGrid[ship.x][ship.y].contents = ship;\n\t\t\t\t\t\t\t\tthis.fullGrid[ship.lastX][ship.lastY].contents = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// ship moved into an empty space\n\t\t\t\t\t\tif (shipKeys.indexOf('lastX') > -1 && shipKeys.indexOf('lastY') > -1) {\n\t\t\t\t\t\t\tif (this.fullGrid[ship.lastX][ship.lastY].contents && this.fullGrid[ship.lastX][ship.lastY].contents.$key === ship.$key) {\n\t\t\t\t\t\t\t\tthis.fullGrid[ship.lastX][ship.lastY].contents = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.fullGrid[ship.x][ship.y].contents = ship;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (this.ship) {\n\t\t\tlet visibleX = this.ship.x + 1 - Math.floor(this.settings.mapX / 2);\n\t\t\tlet visibleY = this.ship.y + 1 - Math.floor(this.settings.mapY / 2);\n\t\t\tfor (let i = 0; i < this.settings.mapX; i++) {\n\t\t\t\tfor (let j = 0; j < this.settings.mapY; j++) {\n\t\t\t\t\tlet gridX = this.wraparound(i + visibleX, this.settings.mapExtent);\n\t\t\t\t\tlet gridY = this.wraparound(j + visibleY, this.settings.mapExtent);\n\t\t\t\t\tthis.visibleGrid[i][j] = this.fullGrid[gridX][gridY];\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.gridObserver.next(this.visibleGrid);\n\t\t}\n\t}\n\n\twraparound(value, limit) {\n\t\tif (value >= limit) {\n\t\t\treturn this.wraparound(value - limit, limit);\n\t\t}\n\t\tif (value < 0) {\n\t\t\treturn this.wraparound(limit + value, limit);\n\t\t}\n\t\treturn value;\n\t}\n\n}\n"]}